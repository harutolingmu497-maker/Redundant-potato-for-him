<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ダイアログ（モーダル）デモ</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo, sans-serif;margin:40px}
    .btn{padding:8px 12px;border-radius:6px;border:1px solid #aaa;background:#f5f5f5;cursor:pointer}
    .btn-primary{background:#0b5ed7;color:#fff;border-color:#0a58ca}
    .btn-danger{background:#dc3545;color:#fff;border-color:#bb2d3b}

    /* モーダルの基本スタイル */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;}
    .dialog{background:#fff;border-radius:8px;max-width:520px;width:100%;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
    .dialog header{padding:16px 20px;border-bottom:1px solid #eee;font-weight:600}
    .dialog .body{padding:20px;color:#222}
    .dialog .footer{padding:12px 16px;border-top:1px solid #eee;text-align:right}

    /* 隠すためのユーティリティ */
    .hidden{display:none}

    /* フォーカスの視覚化（アクセシビリティ確認用） */
    button:focus{outline:3px solid #b6d4ff;outline-offset:2px}
    /* スクリーンリーダ向け非表示 */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <h1>モーダルダイアログのデモ</h1>
  <p>下のボタンで確認ダイアログを開きます。キーボードで操作してアクセシビリティを確認してください（Tab / Shift+Tab / Esc）。</p>

  <button id="open" class="btn btn-primary">削除ダイアログを開く</button>

  <!-- モーダル本体（初期は非表示） -->
  <div id="modal" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="dialog-title" aria-describedby="dialog-desc">
    <div class="dialog" role="document">
      <header id="dialog-title">アイテムを削除しますか？</header>
      <div class="body">
        <p id="dialog-desc">この操作は元に戻せません。削除する場合は「削除」をクリックしてください。</p>
        <p><strong>対象:</strong> サンプルアイテム 001</p>
      </div>
      <div class="footer">
        <button id="cancel" class="btn">キャンセル</button>
        <button id="delete" class="btn btn-danger">削除</button>
      </div>
    </div>
  </div>

  <script>
    // シンプルなフォーカスマネージャ
    const openBtn = document.getElementById('open');
    const modal = document.getElementById('modal');
    const cancelBtn = document.getElementById('cancel');
    const deleteBtn = document.getElementById('delete');

    // フォーカストラップ用のフォーカス可能要素を取得
    function getFocusable(container){
      return Array.from(container.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'))
        .filter(el => !el.hasAttribute('disabled'));
    }

    // 開く
    openBtn.addEventListener('click', ()=>{
      // 表示
      modal.classList.remove('hidden');
      // 背景をスクリーンリーダーから隠す
      document.querySelectorAll('body > *:not(#modal)').forEach(el => el.setAttribute('aria-hidden', 'true'));
      modal.removeAttribute('aria-hidden');
      // 最初のフォーカスをキャンセルボタンに移す
      cancelBtn.focus();
      // ページスクロール防止（簡易）
      document.body.style.overflow = 'hidden';
    });

    // 閉じるヘルパー
    function closeModal(returnValue){
      modal.classList.add('hidden');
      document.body.style.overflow = '';
      // 背景の aria-hidden を解除
      document.querySelectorAll('body > *:not(#modal)').forEach(el => el.removeAttribute('aria-hidden'));
      openBtn.focus();
      console.log('dialog result:', returnValue);
    }

    cancelBtn.addEventListener('click', ()=> closeModal('cancel'));
    deleteBtn.addEventListener('click', ()=> closeModal('delete'));

    // キーボード操作: Esc で閉じる。Tab のフォーカストラップを実装
    window.addEventListener('keydown', (ev)=>{
      if(ev.key === 'Escape' && !modal.classList.contains('hidden')){
        closeModal('esc');
      }

      if(ev.key === 'Tab' && !modal.classList.contains('hidden')){
        const focusable = getFocusable(modal.querySelector('.dialog'));
        if(focusable.length === 0) return;
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        if(ev.shiftKey && document.activeElement === first){
          ev.preventDefault();
          last.focus();
        } else if(!ev.shiftKey && document.activeElement === last){
          ev.preventDefault();
          first.focus();
        }
      }
    });

    // 背景クリックで閉じる（モードレス風にしたければ削除）
    modal.addEventListener('click', (ev)=>{
      if(ev.target === modal){
        closeModal('background');
      }
    });
  </script>
</body>
</html>
